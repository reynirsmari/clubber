<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clubbr — Golf Club Selector</title>
  <style>
    :root { --bg:#f8fafc; --card:#ffffff; --muted:#6b7280; --text:#0f172a; --border:#e5e7eb; --accent:#10b981; }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial; background:var(--bg); color:var(--text)}
    .container{max-width:960px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px}
    @media (min-width: 768px){ .grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:repeat(3,1fr)} }
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 1px 3px rgba(0,0,0,0.04)}
    h1{font-size:28px;margin:0 0 8px; display:flex; align-items:center; gap:12px}
    h2{font-size:18px;margin:0 0 8px}
    label{font-size:14px;color:var(--muted);display:block;margin:8px 0 4px}
    input[type=number], .btn{border:1px solid var(--border);border-radius:12px;padding:10px 12px}
    input[type=number]{width:100%}
    input[type=range]{width:100%}
    .btn{background:#fff;cursor:pointer}
    .btn-primary{background:var(--accent); color:#fff; border-color:transparent}
    .btn-slim{padding:8px 12px; font-size:14px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted);font-size:12px}
    .pill{background:#f1f5f9;border:1px solid var(--border); padding:8px 12px; border-radius:12px}
    .arrow-grid{display:grid; grid-template-columns:repeat(4,1fr); gap:8px}
    .arrow{padding:10px 0; text-align:center; border:1px solid var(--border); border-radius:10px; background:#fff; cursor:pointer; user-select:none}
    .arrow.active{background:#000; color:#fff}
    .kpi{background:#f1f5f9; border-radius:12px; padding:12px}
    .kpi .label{color:var(--muted); font-size:12px}
    .kpi .value{font-weight:700; font-size:20px}
    .alt{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px}
    .footer{color:var(--muted); font-size:12px; text-align:center; padding-top:8px}
    .warn{background:#fef2f2; border:1px solid #fecaca; color:#7f1d1d; padding:12px; border-radius:12px}
    .list{display:grid; gap:8px}
    .grid-alt{display:grid; gap:10px}
    .grid-alt > div{display:flex;justify-content:space-between;align-items:center}
    img.logo{height:80px;width:80px;border-radius:16px;object-fit:cover}
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <h1><img src="logo.png" class="logo" alt="Clubbr logo"/> Clubbr — Golf Club Selector</h1>

    <div class="grid grid-2">
      <div class="card">
        <h2>Shot</h2>
        <label>Target distance (m)</label>
        <input type="number" id="inp-distance" min="0" max="400" value="150"/>
        <label>Elevation change (m)</label>
        <input type="range" id="inp-elev" min="-30" max="30" step="1" value="0"/>
        <div class="muted" id="elev-label">0 m (+ uphill)</div>
      </div>

      <div class="card">
        <h2>Wind</h2>
        <p class="muted" style="margin-top:-4px">
          Arrows show the <b>direction the wind is blowing</b>. You are hitting toward the <b>TOP</b> of the screen.
          <b>↓ = headwind</b>, <b>↑ = tailwind</b>.
        </p>
        <label>Direction</label>
        <div class="arrow-grid" id="wind-grid"></div>
        <label style="margin-top:8px">Speed (m/s)</label>
        <input type="range" id="inp-wind" min="0" max="20" step="1" value="0"/>
        <div class="muted"><span id="wind-speed">0</span> m/s</div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row">
        <h2>Effective Yardage</h2>
        <button id="recalc" class="btn btn-primary">Recalculate</button>
      </div>
      <div class="grid grid-3" style="margin-top:8px">
        <div class="kpi">
          <div class="label">Raw distance</div>
          <div class="value" id="raw-dist">150 m</div>
        </div>
        <div class="kpi">
          <div class="label">Wind adjustment</div>
          <div class="value" id="wind-adj">+0 m</div>
        </div>
        <div class="kpi">
          <div class="label">Elevation adjustment</div>
          <div class="value" id="elev-adj">+0 m</div>
        </div>
      </div>
      <div style="margin-top:8px">Plays as <b id="plays-as">150 m</b></div>
      <div class="muted" style="margin-top:6px">Tip: change the inputs, then press <b>Recalculate</b> to update the recommendation.</div>
    </div>

    <div class="card" style="margin-top:16px">
      <h2>Recommendation</h2>
      <div id="warn-long" class="warn" style="display:none">This shot plays longer than your longest club. Consider laying up or a different strategy.</div>
      <div class="grid grid-2" style="margin-top:8px">
        <div>
          <div class="pill" id="primary-card">
            <div class="muted" style="font-size:12px">Primary</div>
            <div style="font-weight:700; font-size:20px" id="primary-label">—</div>
            <div class="muted" id="primary-swing">Target swing: —</div>
            <div class="muted" style="font-size:12px" id="primary-carry">Baseline carry —</div>
          </div>
        </div>
        <div class="grid-alt" id="alt-list"></div>
      </div>
      <p class="muted" style="margin-top:8px">
        Notes: Headwind increases effective distance by ~0.8% per m/s; tailwind reduces by ~0.5% per m/s.
        Elevation adds ~1.25 m per 1 m uphill and subtracts ~1.0 m per 1 m downhill. These are tunable heuristics.
      </p>
    </div>

    <div id="bag-editor" class="card" style="margin-top:16px; display:none">
      <h2>My Bag Distances (carry in meters)</h2>
      <div id="bag-list" class="list"></div>
    </div>

    <div class="center" style="margin-top:12px">
      <button id="toggle-bag" class="btn btn-slim">Edit My Bag Distances</button>
    </div>

    <div class="footer">Inspired by Hemmi</div>
  </div>

<script>
  const DEFAULT_BAG = [
    { key: "driver", label: "Driver", carry: 250 },
    { key: "5w", label: "5 Wood", carry: 220 },
    { key: "4i", label: "4 Iron", carry: 200 },
    { key: "5i", label: "5 Iron", carry: 180 },
    { key: "6i", label: "6 Iron", carry: 170 },
    { key: "7i", label: "7 Iron", carry: 150 },
    { key: "8i", label: "8 Iron", carry: 140 },
    { key: "9i", label: "9 Iron", carry: 130 },
    { key: "p", label: "Pitching Wedge (P)", carry: 120 },
    { key: "48", label: "48° Wedge", carry: 100 },
    { key: "56", label: "56° Wedge", carry: 80 },
  ];

  // Player hits toward TOP. Arrows represent the direction the wind BLOWS.
  // ↓ = headwind, ↑ = tailwind.
  const WIND_DIRECTIONS = [
    { code: "D",  label: "Headwind (↓) / R→L", thetaDeg: 0,   arrow: "↓"  },
    { code: "DL", label: "Headwind (↙) / R→L", thetaDeg: 45,  arrow: "↙" },
    { code: "L",  label: "Cross (←) R→L",      thetaDeg: 90,  arrow: "←" },
    { code: "UL", label: "Tailwind (↖) / R→L", thetaDeg: 135, arrow: "↖" },
    { code: "U",  label: "Tailwind (↑)",       thetaDeg: 180, arrow: "↑" },
    { code: "UR", label: "Tailwind (↗) / L→R", thetaDeg: 225, arrow: "↗" },
    { code: "R",  label: "Cross (→) L→R",      thetaDeg: 270, arrow: "→" },
    { code: "DR", label: "Headwind (↘) / L→R", thetaDeg: 315, arrow: "↘" },
  ];

  // Committed state
  let distance = 150;
  let elevation = 0;
  let windSpeed = 0;
  let windThetaDeg = 0; // default to headwind

  // Inputs
  const inpDistance = document.getElementById("inp-distance");
  const inpElev = document.getElementById("inp-elev");
  const inpWind = document.getElementById("inp-wind");
  const elevLabel = document.getElementById("elev-label");
  const windSpeedLbl = document.getElementById("wind-speed");

  // Build the wind arrow selector
  const windGrid = document.getElementById("wind-grid");
  let thetaInput = 0; // start at headwind (↓)
  WIND_DIRECTIONS.forEach(d => {
    const btn = document.createElement("button");
    btn.className = "arrow";
    btn.textContent = d.arrow;
    btn.title = d.label;
    btn.onclick = () => {
      document.querySelectorAll(".arrow").forEach(a => a.classList.remove("active"));
      btn.classList.add("active");
      thetaInput = d.thetaDeg;
    };
    windGrid.appendChild(btn);
  });
  // set default active
  windGrid.querySelector(".arrow").classList.add("active");

  inpElev.addEventListener("input", () => {
    const v = Number(inpElev.value);
    elevLabel.textContent = `${v} m (${v >= 0 ? "+ uphill" : "- downhill"})`;
  });
  inpWind.addEventListener("input", () => { windSpeedLbl.textContent = inpWind.value; });

  // Bag editor
  const bagEditor = document.getElementById("bag-editor");
  const bagList = document.getElementById("bag-list");
  let bag = JSON.parse(localStorage.getItem("clubbr_bag") || "null") || DEFAULT_BAG.slice();
  function renderBag() {
    bagList.innerHTML = "";
    bag.forEach((c, idx) => {
      const row = document.createElement("div");
      row.style.display = "flex";
      row.style.alignItems = "center";
      row.style.justifyContent = "space-between";
      row.style.gap = "12px";
      const left = document.createElement("div");
      left.textContent = c.label;
      left.style.minWidth = "50%";
      const inp = document.createElement("input");
      inp.type = "number";
      inp.value = c.carry;
      inp.min = 30; inp.max = 350; inp.step = 1;
      inp.onchange = () => {
        bag[idx].carry = Number(inp.value)||0;
        localStorage.setItem("clubbr_bag", JSON.stringify(bag));
      };
      row.appendChild(left);
      row.appendChild(inp);
      bagList.appendChild(row);
    });
  }
  renderBag();

  document.getElementById("toggle-bag").onclick = () => {
    bagEditor.style.display = bagEditor.style.display === "none" ? "block" : "none";
  };

  // KPI elements
  const rawDist = document.getElementById("raw-dist");
  const windAdj = document.getElementById("wind-adj");
  const elevAdj = document.getElementById("elev-adj");
  const playsAs = document.getElementById("plays-as");

  // Recommendation UI
  const warnLong = document.getElementById("warn-long");
  const primaryLabel = document.getElementById("primary-label");
  const primarySwing = document.getElementById("primary-swing");
  const primaryCarry = document.getElementById("primary-carry");
  const altList = document.getElementById("alt-list");

  function toRadians(deg){ return (deg*Math.PI)/180; }
  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
  function fmt(m){ return `${Math.round(m)} m`; }
  function forceLabel(p){
    if (p < 65) return "very smooth";
    if (p < 80) return "smooth";
    if (p < 95) return "normal";
    if (p < 105) return "firm";
    return "all out";
  }

  // Physics constants (asymmetric head/tail behavior)
  const HEADWIND_PCT_PER_MPS = 0.008; // +0.8% per m/s
  const TAILWIND_PCT_PER_MPS = 0.005; // -0.5% per m/s
  const UPHILL_M_PER_M = 1.25;
  const DOWNHILL_M_PER_M = 1.0;

  function compute() {
    // Project wind along target line: + = headwind, - = tailwind
    const along = windSpeed * Math.cos(toRadians(windThetaDeg));
    const head = Math.max(0, along);
    const tail = Math.max(0, -along);
    const windAdjVal = distance * (head * HEADWIND_PCT_PER_MPS - tail * TAILWIND_PCT_PER_MPS);

    // Elevation: uphill adds, downhill subtracts
    const elevAdjVal = elevation >= 0 ? elevation * UPHILL_M_PER_M : elevation * DOWNHILL_M_PER_M;

    const eff = Math.max(0, distance + windAdjVal + elevAdjVal);

    rawDist.textContent = fmt(distance);
    windAdj.textContent = `${windAdjVal>=0?"+":""}${fmt(windAdjVal)}`;
    elevAdj.textContent = `${elevAdjVal>=0?"+":""}${fmt(elevAdjVal)}`;
    playsAs.textContent = fmt(eff);

    // Recommendation (shortest → longest)
    const sorted = bag.slice().sort((a,b)=>a.carry-b.carry);
    let primary = sorted.find(c => c.carry >= eff);
    if (!primary) primary = sorted[sorted.length-1];

    const swing = clamp((eff / primary.carry) * 100, 50, 115);
    primaryLabel.textContent = primary.label;
    primarySwing.textContent = `Target swing: ${Math.round(swing)}% (${forceLabel(swing)})`;
    primaryCarry.textContent = `Baseline carry ${fmt(primary.carry)}`;

    const idx = sorted.findIndex(c=>c.key===primary.key);
    const altDown = sorted[idx-1];
    const altUp = sorted[idx+1];
    altList.innerHTML = "";
    [altDown, altUp].forEach(alt => {
      if (!alt) return;
      const altSwing = clamp((eff / alt.carry) * 100, 50, 115);
      const div = document.createElement("div");
      div.className = "alt";
      div.innerHTML = `<div style="font-size:12px;color:var(--muted)">Alternative</div>
                       <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
                         <div style="font-weight:600">${alt.label}</div>
                         <div>${Math.round(altSwing)}% (${forceLabel(altSwing)})</div>
                       </div>
                       <div class="muted" style="font-size:12px">Carry ${fmt(alt.carry)}</div>`;
      altList.appendChild(div);
    });

    warnLong.style.display = eff > sorted[sorted.length-1].carry ? "block" : "none";
  }

  // Recalculate button applies inputs
  document.getElementById("recalc").onclick = () => {
    distance = Number(inpDistance.value)||0;
    elevation = Number(inpElev.value)||0;
    windSpeed = Number(inpWind.value)||0;
    windThetaDeg = thetaInput;
    compute();
  };

  // Initial render
  compute();
</script>
</body>
</html>
